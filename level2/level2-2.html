<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
    <div class="container-fluid">
        <div class="heading">
            <h1 style="text-align: center;"><a href="../index.html">Programavimo valanda</a></h1>
        </div>
        <div class="progress-container">
            <ul style="text-align: center;">
                <li>
                    <a href="level1-1.html">1</a>
                </li>
                <li>
                    <a href="level1-2.html">2</a>
                </li>
                <li>
                    <a href="level1-3.html">3</a>
                </li>
                <li>
                    <a href="level1-4.html">4</a>
                </li>
                <li>
                    <a href="level1-5.html">5</a>
                </li>
                <li>
                    <a href="level1-6.html">6</a>
                </li>
                <li>
                    <a href="level1-7.html">7</a>
                </li>
                <li>
                    <a href="level1-8.html">8</a>
                </li>
                <li>
                    <a href="level1-9.html">9</a>
                </li>
                <li>
                    <a href="level1-10.html">10</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="container-fluid working-space">
        <div class="row" style="padding: 10px;">
            <div class="col-md-5">
                <h4>Dariaus ir Girėno skrydis. LITUANICA</h4></div>
            <div class=" col-md-7" id="task"> Tikslas - atkartoti Dariaus ir Girėno kelionės maršrutą (trasa buvo suskirstyta į tris etapus: Niujorkas-Niufaundlandas, Atlanto vandenynas, Airija-Kaunas).
                <a href="javascript:void(0)" onclick="changeVideo('isnwxt2Z5Dw')">Užduoties video</a> </div>
        </div>
        <div class="row" style="padding: 10px">
            <div class="col  ">
                <div id="preview">
                    <canvas id="canvas" width="490" height="330" style="z-index: 0">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <!--  <canvas id="canvas2" width="490" height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas> -->
                    <canvas id="canvas3" width="490" height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <div id="lituanica_plane"></div>
                </div>
                <div class="button-panel">
                    <button class="button-run btn btn-lg btn-secondary" onclick="runCode()">PALEISTI &#x25BA; </button>
                </div>
                <div class="hint-panel">
                    <ul> Jei sunku:
                        <li>
                            <a href="javascript:void(0)" data-toggle="popover" data-trigger="focus" title="HINT1" data-content="Pagalbos tekstas numeris 1. Reikia tramparamparam.">HINT1</a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" data-toggle="popover" data-trigger="focus" title="HINT2" data-content="Pagalbos tekstas numeris 2. Reikia tramparamparam">HINT2</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col" style="padding: 0 ;">
                <div id="blocklyDiv">
                </div>
                <xml id="toolbox" style="display: none">
                    <!-- <category name="Raidės"> -->
                    <!-- <block type="spalva">
                    </block> -->
<!--                     <block type="grid_turnleft">
                    </block>
                    <block type="grid_turnright">
                    </block>
                    <block type="grid_goforward">
                    </block>
                    <block type="grid_forward">
                    </block>
                    <block type="wait_seconds"> -->
                    </block>
                      <block type="fly_to">
                    </block>  
                    <block type="fly_points">
                    </block>
                </xml>
            </div>
            <div class="col-md-3 col-lg-2" style="height: 70vh;">
                <h5>Javascript kodas: </h5>
                <pre id="content_javascript">
                </pre>
            </div>
        </div>
        <div class="video-modal">
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <iframe id="iframeYoutube" width="100%" height="315" src="https://www.youtube.com/embed/isnwxt2Z5Dw  " frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="next-modal">
            <div class="modal fade" id="nextModal" tabindex="-1" role="dialog" aria-labelledby="nextModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <a href="#" type="button" class="btn btn-default" data-dismiss="modal">Tęsti</a>
                            <a href="level1-2.html" type="button" class="btn btn-default">Sekanti užduotis</a>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <img style="visibility: hidden;">
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/acorn_interpreter.js"></script>
    <script src="../js/blockly_compressed.js"></script>
    <script src="../js/javascript_compressed.js"></script>
    <script src="../js/blocks_compressed.js"></script>
    <script src="../msg/js/lt.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/lituanica.js"></script>
    <script type="text/javascript">
    var my_canvas = document.getElementById("canvas");
    var background = my_canvas.getContext("2d");
    var lituanica_canvas = document.getElementById("canvas3");
    var lituanica = lituanica_canvas.getContext("2d");
    var map = new Image();
    map.src = "../test_img/atlantas.png";
    var plane = new Image();
    plane.src = "../test_img/litu.png";
    var plane_left = new Image();
    plane_left.src = "../test_img/litu-left.png";
    var plane_right = new Image();
    plane_right.src = "../test_img/litu-right.png";

    var angleInDegrees = 0;
    var plain_x = 50;
    var plain_y = 100;

    var plane_state = "plane";
    var x_deg = 0;
    var finished = false;

    plane.onload = function() {
        // lituanica.drawImage(plane, plain_x, plain_y);
    };
    map.onload = function() {
        //draw(map, 0, 0, 500,300);

        background.drawImage(map, 0, 0);
        drawGrid();

    }

    function drawGrid() {

        //newyork
        background.fillRect(100, 120, 4, 4);
        background.beginPath();
        background.arc(102, 122, 8, 0, 2 * Math.PI);
        background.stroke();
        //newfoundland
        background.fillRect(180, 90, 4, 4);
        background.beginPath();
        background.arc(182, 92, 8, 0, 2 * Math.PI);
        background.stroke();
        //Airija
        background.fillRect(330, 75, 4, 4);
        background.beginPath();
        background.arc(332, 77, 8, 0, 2 * Math.PI);
        background.stroke();
        //Kaunas
        background.fillRect(425, 67, 4, 4);
        background.beginPath();
        background.arc(427, 69, 8, 0, 2 * Math.PI);
        background.stroke();
        //Lenkija, ex Vokietija, 
        background.fillRect(400, 80, 4, 4);
        background.beginPath();
        background.arc(402, 82, 8, 0, 2 * Math.PI);
        background.strokeStyle = '#ff0000';
        background.stroke();

        background.strokeStyle = 'black';
        for (i = 0; i < 490; i += 50) {
            background.beginPath();
            background.moveTo(i, 0);
            background.lineTo(i, 330);
            background.stroke();
        }
        for (i = 0; i < 330; i += 50) {
            background.beginPath();
            background.moveTo(0, i);
            background.lineTo(490, i);
            background.stroke();
        }

    }
    </script>
    <script>
    var workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        grid: {
            spacing: 20,
            length: 5,
            colour: '#E1D82C',
            snap: true
        },
        trashcan: true
    });

    function toJavascript(event) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        document.getElementById('content_javascript').innerHTML = code;
    }
    workspace.addChangeListener(toJavascript);
    </script>
    <script type="text/javascript">
    function runCode() {

        Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\n';
        Blockly.JavaScript.addReservedWords('highlightBlock');
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        var myInterpreter = new Interpreter(code, initApi);

        background.clearRect(0, 0, canvas.width, canvas.height);
        background.strokeStyle = "black";
        background.drawImage(map, 0, 0);
        drawGrid();
        plain_x = 50;
        plain_y = 100;
        var move = 0;
        x_deg = 0;
        finished = false;
        try {

            if (code.length > 0) {
                //eval(code);
                function nextStep() {
                    if (myInterpreter.step()) {
                        window.setTimeout(nextStep, 0);
                    }
                }
                nextStep();
               // myInterpreter.run();
            } else {
                alert('Pridėk kodo blokelį.');
            }

        } catch (e) {
            alert(e);
        }
    }


    function initApi(interpreter, scope) {

        // Add an API function for the alert() block.
        var wrapper = function(text) {
            text = text ? text.toString() : '';
            return interpreter.createPrimitive(alert(text));
        };
        interpreter.setProperty(scope, 'alert',
            interpreter.createNativeFunction(wrapper));

        // Add an API function for the prompt() block.
        wrapper = function(text) {
            text = text ? text.toString() : '';
            return interpreter.createPrimitive(prompt(text));
        };
        interpreter.setProperty(scope, 'prompt',
            interpreter.createNativeFunction(wrapper));
        // Add an API function for highlighting blocks.
        var wrapper = function(id) {
            id = id ? id.toString() : '';
            return interpreter.createPrimitive(Blockly.mainWorkspace.highlightBlock(id));
        };
        interpreter.setProperty(scope, 'highlightBlock',
            interpreter.createNativeFunction(wrapper));

        /***********************************************************************/


         var move = 0;
        Blockly.JavaScript.addReservedWords('updatePlane');

        var wrapper = interpreter.createAsyncFunction(
            function updatePlane(x,y,callback) {  
                x = x-plain_x-25;
                y = y-plain_y-25;
                changePoints(x,y);
                callback();
            } 
            );
       
        interpreter.setProperty(scope, 'updatePlane', wrapper);

        /***********************************************************************/

        Blockly.JavaScript.addReservedWords('updatePlaneLeft');

        var wrapper = interpreter.createAsyncFunction(
            function updatePlaneLeft(x) {
                if (x > 0) {
                   globalID2 = requestAnimationFrame(function() { updatePlaneLeft(x); });
                }
                document.getElementById("lituanica_plane").style.transform = "translate(" + plain_x + "px, " + plain_y + "px)";
                plain_y -= 1;
                x -= 1;
            });
        interpreter.setProperty(scope, 'updatePlaneLeft', wrapper);
        /***********************************************************************/

        Blockly.JavaScript.addReservedWords('updatePlaneRight');

        var wrapper = interpreter.createAsyncFunction(
            function updatePlaneRight(x) {
                if (x > 0) {
                   globalID3 = requestAnimationFrame(function() { updatePlaneRight(x); });
                }else{cancelAnimationFrame(globalID3);}
                document.getElementById("lituanica_plane").style.transform = "translate(" + plain_x + "px, " + plain_y + "px)";
                plain_y += 1;
                x -= 1;
            });
        interpreter.setProperty(scope, 'updatePlaneRight', wrapper);

        /*************************************************************************/
          Blockly.JavaScript.addReservedWords('waitForSeconds');

  var wrapper = interpreter.createAsyncFunction(
    function(timeInSeconds, callback) {
      // Delay the call to the callback.
      setTimeout(callback, timeInSeconds * 1000);
    });
  interpreter.setProperty(scope, 'waitForSeconds', wrapper);

    }

    </script>
</body>

</html>